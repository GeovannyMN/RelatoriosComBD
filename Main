package br.com.gnovais;

import java.io.Console;
import java.sql.SQLException;
import java.sql.Time;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;

public class Main {

    static Console console = System.console();
    public static void main(String[] args) {
        
        int opcao;
        do {
            exibirMenu();
            opcao = Integer.parseInt(console.readLine());
            switch (opcao) {
                case 0 -> System.exit(0);
                case 1 -> salvarVenda();
                case 2 -> buscarTodasVendas();
                case 3 -> buscarVendaPorId();
                case 4 -> buscarVendaPorValor();
                case 5 -> buscarVendaPorFormaDePagamento();
                case 6 -> buscarVendaPorHorario();
                case 7 -> atualizarVenda();
                case 8 -> excluirVenda();
                default -> System.out.println("Opção inválida!");
            }
        } while (opcao != 5);
        
    }

    private static void exibirMenu() {
        System.out.println("\n### Menu de Operações ###");
        System.out.println("0. Sair do programa");
        System.out.println("1. Salvar nova venda");
        System.out.println("2. Buscar todas as Vendas");
        System.out.println("3. Buscar Venda por ID");
        System.out.println("4. Buscar Venda por Valor");
        System.out.println("5. Buscar Venda por Forma de Pagamento");
        System.out.println("6. Buscar Venda por Horário");
        System.out.println("7. Atualizar Venda");
        System.out.println("8. Excluir Venda");
       
        System.out.print("Escolha uma opção: ");
    }

    private static void salvarVenda() {
        System.out.println("\n### Criar Nova Venda ###");

        System.out.println("\nValor:");
        float valor = 0;
        try {
            valor = Float.parseFloat(console.readLine());
        } catch (NumberFormatException e) {
            System.out.println("Valor digitado não é válido!");
        } 

        System.out.println("\nForma de pagamento:");
        String formaDePagamento = console.readLine();

        System.out.println("\nHorário:");

        SimpleDateFormat sdf = new SimpleDateFormat("HH:mm:ss");
        Date data;
        Time horaTime;

        Venda venda;

        VendaDAO vendaDAO = new VendaDAO();

        try {
            data = sdf.parse(console.readLine());
            horaTime = new java.sql.Time(data.getTime());     
            
            venda = new Venda(valor, formaDePagamento, horaTime);

            try{
                vendaDAO.salvar(venda);
                System.out.println("Venda salva corretamente!");
            }catch(SQLException e)
            {
                System.out.println("Erro: Não foi possível salvar a venda");
            }

        } catch (ParseException e) {
            System.out.println("Não foi possível converter a hora corretamente!");
        }
    }

    private static void imprimirVenda(Venda venda)
    {
        System.out.print("ID: " + venda.id() + " ");
        System.out.printf("Valor: R$%.2f ", venda.valor());
        System.out.print("Forma de Pagamento: " + venda.formaDePagamento() + " ");
        System.out.println("Horário: " + venda.hora() + "\n");
    }

    private static void buscarTodasVendas() {
        System.out.println("\n### Buscar Todas As Vendas ###");  
        
        VendaDAO vendaDAO = new VendaDAO();

        try {
            List<Venda> vendasEncontradas = vendaDAO.buscarPorTodasVendas();

            if (vendasEncontradas != null)
            {
                System.out.println("Lista de vendas!");
                for (Venda venda : vendasEncontradas)
                {
                    imprimirVenda(venda);
                }
            }else{
                System.out.println("Não foi encontrada nenhuma venda!");
            }
            
        } catch (SQLException e) {
            System.out.println("Erro: Não foi possível encontrar todas as vendas!");
        }
    }

    private static void buscarVendaPorId() {
        System.out.println("\n### Buscar Venda Por ID ###");

        System.out.println("\nID:");
        int id = Integer.parseInt(console.readLine());

        System.out.println("ID informado:" + id);

        VendaDAO vendaDAO = new VendaDAO();

        @SuppressWarnings("unused")
        Venda venda;

        try {
            venda = vendaDAO.buscarPorID(id);

            if (venda != null){
                System.out.println("Encontramos a seguinte venda através do ID informado:");
                imprimirVenda(venda);
            }else{
                System.out.println("Não foi encontrada nenhuma venda com o ID informado!");
            }

        } catch (SQLException e) {
            System.out.println("Erro: Não foi possível encontrar a venda com o ID informado!");
        }
    }

    private static void buscarVendaPorValor() {
        System.out.println("\n### Buscar Venda Por Valor ###");
        
        System.out.println("\nValor:");
        float valor = 0;
        try {
            valor = Float.parseFloat(console.readLine());
        }catch (NumberFormatException e){
            System.out.println("Valor digitado não é válido!");
        }

        System.out.println("Valor informado: " + valor);

        System.out.println("\nOperações disponíveis: >, >=, =, <, <=");
        String operacao = console.readLine();

        System.out.println("Operação informada: " + operacao + "\n");


        VendaDAO vendaDAO = new VendaDAO();

        try {
            List<Venda> vendasEncontradas = vendaDAO.buscarVendaPorValor(valor, operacao);

            if (vendasEncontradas != null)
            {
                System.out.println("Lista de vendas!");
                for (Venda venda : vendasEncontradas)
                {
                    imprimirVenda(venda);
                }
            }else{
                System.out.println("Não foi encontrada nenhuma venda com o valor informado!");
            }

        } catch (SQLException e) {
            System.out.println("Erro: Não foi possível encontrar a venda com o valor informado!");
        }
    }

    private static void buscarVendaPorFormaDePagamento() {
        System.out.println("\n### Buscar Venda Por Forma De Pagamento ###");

        System.out.println("\nForma De Pagamento:");
        String formaDePagamento = console.readLine();

        System.out.println("Forma de pagamento informada: " + formaDePagamento);

        VendaDAO vendaDAO = new VendaDAO();

        try {
            List<Venda> vendasEncontradas = vendaDAO.buscarVendaPorFormaDePagamento(formaDePagamento);

            if (vendasEncontradas != null)
            {
                System.out.println("Lista de vendas!");
                for (Venda venda : vendasEncontradas)
                {
                    imprimirVenda(venda);
                }
            }else{
                System.out.println("Não foi encontrada nenhuma venda com a forma de pagamento informada!");
            }

        } catch (SQLException e) {
            System.out.println("Erro: Não foi possível encontrar a venda com a forma de pagamento informada!");
        }
    }

    private static void buscarVendaPorHorario() {
        System.out.println("\n### Buscar Venda Por Horário ###");

        System.out.println("\nHorário:");

        SimpleDateFormat sdf = new SimpleDateFormat("HH:mm:ss");
        Date data;
        Time horaTime;

        VendaDAO vendaDAO = new VendaDAO();

        try {
            data = sdf.parse(console.readLine());
            horaTime = new java.sql.Time(data.getTime()); 

            System.out.println("Horário informado: " + horaTime);

                try {
                    List<Venda> vendasEncontradas = vendaDAO.buscarVendaPorHorario(horaTime);

                    if (vendasEncontradas != null)
                    {
                        System.out.println("Lista de vendas!");
                        for (Venda venda : vendasEncontradas)
                        {
                            imprimirVenda(venda);
                        }
                    }else{
                        System.out.println("Não foi encontrada nenhuma venda com o horário informado!");
                    }

                } catch (SQLException e) {
                    System.out.println("Erro: Não foi possível encontrar vendas com o horário informado!");
                }
        }catch (ParseException e)
        {
            System.out.println("Horário informado não é válido!");
        }
        
    }

    private static void atualizarVenda() {
        System.out.println("\n### Atualizar Venda ###");

        System.out.println("\nID do produto para atualizar:");
        int id = Integer.parseInt(console.readLine());

        System.out.println("ID informado:" + id);

        VendaDAO vendaDAO = new VendaDAO();
        
        @SuppressWarnings("unused")
        Venda vendaAntes;

        @SuppressWarnings("unused")
        Venda vendaDepois;

        try {
            vendaAntes = vendaDAO.buscarPorID(id);

            if (vendaAntes != null){
                
                System.out.printf("\nO valor anterior era: R$%.2f\nNovo valor:\n", vendaAntes.valor());
                float valor = Float.parseFloat(console.readLine());

                System.out.println("\nO forma de pagamento anterior era:" + vendaAntes.formaDePagamento() + "\nNova forma de pagamento:");
                String formaDePagamento = console.readLine();

                System.out.println("\nO horário anterior era:" + vendaAntes.hora() + "\nNovo horário:");

                SimpleDateFormat sdf = new SimpleDateFormat("HH:mm:ss");
                Date data;
                Time horaTime;

                try {
                    data = sdf.parse(console.readLine());
                    horaTime = new java.sql.Time(data.getTime());     
                
                    vendaDepois = new Venda(vendaAntes.id(), valor, formaDePagamento, horaTime);

                    try{
                        vendaDAO.atualizar(vendaDepois);
                        System.out.println("Venda atualizada corretamente!");
                    }catch(SQLException e)
                    {
                        System.out.println("Erro: Não foi possível salvar a venda");
                    }


                }catch(ParseException e)
                {
                    System.out.println("Não foi possível atualizar o produto");
                }

            }else{
                System.out.println("Não foi encontrada nenhuma venda com o ID informado!");
            }

        } catch (SQLException e) {
            System.out.println("Erro: Não foi possível atualizar a venda com o ID informado!");
        }
    }

    private static void excluirVenda() {
        System.out.println("\n### Excluir Venda ###");

        System.out.println("\nID do produto para excluir:");
        int id = Integer.parseInt(console.readLine());

        System.out.println("ID informado:" + id);

        VendaDAO vendaDAO = new VendaDAO();
        
        @SuppressWarnings("unused")
        Venda vendaAExcluir;

        try {
            vendaAExcluir = vendaDAO.buscarPorID(id);

            if (vendaAExcluir != null){
                vendaDAO.excluir(vendaAExcluir.id());
                System.out.println("Venda excluída corretamente!");
            }else{
                System.out.println("Não foi encontrada nenhuma venda com o ID informado!");
            }

        } catch (SQLException e) {
            System.out.println("Erro: Não foi possível excluir a venda com o ID informado!");
        }
    }


}
